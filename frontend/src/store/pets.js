// store/pets.js
import { defineStore } from 'pinia'
import { ref } from 'vue'
import api from '@/utils/axios'

export const usePetsStore = defineStore('pets', () => {
  /* â”€â”€ state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  const myPets       = ref([])   // ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ²ÑĞµÑ… Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†ĞµĞ² Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¸Ğ³Ñ€Ğ¾ĞºĞ°
  const currentPet   = ref(null) // Ğ¿Ğ¾Ğ´Ñ€Ğ¾Ğ±Ğ½Ğ¾ÑÑ‚Ğ¸ Ğ²Ñ‹Ğ±Ñ€Ğ°Ğ½Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†Ğ°

  const isLoadingAll = ref(false)
  const isLoadingOne = ref(false)

  /* â”€â”€ actions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */

  /** ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ Ğ²ÑĞµÑ… Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†ĞµĞ² Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ */
  async function fetchAllPets () {
    
    isLoadingAll.value = true
    
    try {
      const res = await api.get('/pets/', { withCredentials: true })
      myPets.value = res.data
      console.log('ğŸ¾ myPets Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ°:', res.data)
    } finally {
      isLoadingAll.value = false
    }
  }

  /** ĞŸĞ¾Ğ»ÑƒÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾Ğ½ĞºÑ€ĞµÑ‚Ğ½Ğ¾Ğ³Ğ¾ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†Ğ° Ğ¿Ğ¾ id */
  async function fetchPetById (id) {
    if (!id) return
    isLoadingOne.value = true
    try {
      const res = await api.get(`/pets/${id}`, { withCredentials: true })
      currentPet.value = res.data
    } finally {
      isLoadingOne.value = false
    }
  }

  /** Ğ¡Ğ±Ñ€Ğ¾ÑĞ¸Ñ‚ÑŒ Ñ‚ĞµĞºÑƒÑ‰ĞµĞ³Ğ¾ Ğ¿Ğ¸Ñ‚Ğ¾Ğ¼Ñ†Ğ° (Ğ¿Ñ€Ğ¸ ÑƒÑ…Ğ¾Ğ´Ğµ ÑĞ¾ ÑÑ‚Ñ€Ğ°Ğ½Ğ¸Ñ†Ñ‹) */
  function clearCurrentPet () {
    currentPet.value = null
  }

  /* â”€â”€ expose â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
  return {
    myPets,
    currentPet,
    isLoadingAll,
    isLoadingOne,

    fetchAllPets,
    fetchPetById,
    clearCurrentPet,
  }
})
